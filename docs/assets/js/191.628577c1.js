"use strict";(self.webpackChunkmobx_cookbook=self.webpackChunkmobx_cookbook||[]).push([[191],{66:(e,t,s)=>{s.d(t,{T:()=>n});var i=s(8471),n=class{constructor(e,t,s={}){this.options=s,this.sandboxSetup=t,this.iframeSelector=e}updateOptions(e){(0,i.J)(this.options,e)||(this.options=e,this.updateSandbox())}updateSandbox(e=this.sandboxSetup,t){throw Error("Method not implemented")}destroy(){throw Error("Method not implemented")}dispatch(e){throw Error("Method not implemented")}listen(e){throw Error("Method not implemented")}}},2191:(e,t,s)=>{s.r(t),s.d(t,{SandpackRuntime:()=>d});var i=s(66),n=s(110),o=s(8471);function r(e,t){if(!e)return"static";const{dependencies:s={},devDependencies:i={}}=e,n=[...Object.keys(s),...Object.keys(i)],o=Object.keys(t),r=["@adonisjs/framework","@adonisjs/core"];if(n.some((e=>r.indexOf(e)>-1)))return"adonis";const a=["nuxt","nuxt-edge","nuxt-ts","nuxt-ts-edge","nuxt3"];if(n.some((e=>a.indexOf(e)>-1)))return"nuxt";if(n.indexOf("next")>-1)return"next";const d=["apollo-server","apollo-server-express","apollo-server-hapi","apollo-server-koa","apollo-server-lambda","apollo-server-micro"];if(n.some((e=>d.indexOf(e)>-1)))return"apollo";if(n.indexOf("mdx-deck")>-1)return"mdx-deck";if(n.indexOf("gridsome")>-1)return"gridsome";if(n.indexOf("vuepress")>-1)return"vuepress";if(n.indexOf("ember-cli")>-1)return"ember";if(n.indexOf("sapper")>-1)return"sapper";if(n.indexOf("gatsby")>-1)return"gatsby";if(n.indexOf("quasar")>-1)return"quasar";if(n.indexOf("@docusaurus/core")>-1)return"docusaurus";if(n.indexOf("remix")>-1)return"remix";if(n.indexOf("astro")>-1)return"node";if(o.some((e=>e.endsWith(".re"))))return"reason";const l=["parcel-bundler","parcel"];if(n.some((e=>l.indexOf(e)>-1)))return"parcel";const h=["@dojo/core","@dojo/framework"];if(n.some((e=>h.indexOf(e)>-1)))return"@dojo/cli-create-app";if(n.indexOf("@nestjs/core")>-1||n.indexOf("@nestjs/common")>-1)return"nest";if(n.indexOf("react-styleguidist")>-1)return"styleguidist";if(n.indexOf("react-scripts")>-1)return"create-react-app";if(n.indexOf("react-scripts-ts")>-1)return"create-react-app-typescript";if(n.indexOf("@angular/core")>-1)return"angular-cli";if(n.indexOf("preact-cli")>-1)return"preact-cli";if(n.indexOf("@sveltech/routify")>-1||n.indexOf("@roxi/routify")>-1)return"node";if(n.indexOf("vite")>-1)return"node";if(n.indexOf("@frontity/core")>-1)return"node";if(n.indexOf("svelte")>-1)return"svelte";if(n.indexOf("vue")>-1)return"vue-cli";if(n.indexOf("cx")>-1)return"cxjs";const c=["express","koa","nodemon","ts-node","@tensorflow/tfjs-node","webpack-dev-server","snowpack"];return n.some((e=>c.indexOf(e)>-1))||Object.keys(s).length>=50?"node":void 0}var a=`https://${"2.0.17".replace(/\./g,"-")}-sandpack.codesandbox.io/`,d=class extends i.T{constructor(e,t,s={}){if(super(e,t,s),this.getTranspilerContext=()=>new Promise((e=>{const t=this.listen((s=>{"transpiler-context"===s.type&&(e(s.data),t())}));this.dispatch({type:"get-transpiler-context"})})),this.bundlerURL=s.bundlerURL||a,this.bundlerState=void 0,this.errors=[],this.status="initializing","string"==typeof e){this.selector=e;const t=document.querySelector(e);(0,n.Wq)(t,`The element '${e}' was not found`),this.element=t,this.iframe=document.createElement("iframe"),this.initializeElement()}else this.element=e,this.iframe=e;this.iframe.getAttribute("sandbox")||(this.iframe.setAttribute("sandbox","allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"),this.iframe.setAttribute("allow","accelerometer; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi;")),this.setLocationURLIntoIFrame(),this.iframeProtocol=new class{constructor(e,t){this.globalListeners={},this.globalListenersCount=0,this.channelListeners={},this.channelListenersCount=0,this.channelId=Math.floor(1e6*Math.random()),this.frameWindow=e.contentWindow,this.origin=t,this.globalListeners=[],this.channelListeners=[],this.eventListener=this.eventListener.bind(this),"undefined"!=typeof window&&window.addEventListener("message",this.eventListener)}cleanup(){window.removeEventListener("message",this.eventListener),this.globalListeners={},this.channelListeners={},this.globalListenersCount=0,this.channelListenersCount=0}register(){this.frameWindow&&this.frameWindow.postMessage({type:"register-frame",origin:document.location.origin,id:this.channelId},this.origin)}dispatch(e){this.frameWindow&&this.frameWindow.postMessage({$id:this.channelId,codesandbox:!0,...e},this.origin)}globalListen(e){if("function"!=typeof e)return()=>{};const t=this.globalListenersCount;return this.globalListeners[t]=e,this.globalListenersCount++,()=>{delete this.globalListeners[t]}}channelListen(e){if("function"!=typeof e)return()=>{};const t=this.channelListenersCount;return this.channelListeners[t]=e,this.channelListenersCount++,()=>{delete this.channelListeners[t]}}eventListener(e){if(e.source!==this.frameWindow)return;const t=e.data;t.codesandbox&&(Object.values(this.globalListeners).forEach((e=>e(t))),t.$id===this.channelId&&Object.values(this.channelListeners).forEach((e=>e(t))))}}(this.iframe,this.bundlerURL),this.unsubscribeGlobalListener=this.iframeProtocol.globalListen((e=>{"initialized"===e.type&&this.iframe.contentWindow&&(this.iframeProtocol.register(),this.options.fileResolver&&(this.fileResolverProtocol=new class{constructor(e,t,s){this.type=e,this.handleMessage=t,this.protocol=s,this._disposeMessageListener=this.protocol.channelListen((async e=>{if(e.type===this.getTypeId()&&e.method){const s=e;try{const e=await this.handleMessage(s),t={type:this.getTypeId(),msgId:s.msgId,result:e};this.protocol.dispatch(t)}catch(t){const e={type:this.getTypeId(),msgId:s.msgId,error:{message:t.message}};this.protocol.dispatch(e)}}}))}getTypeId(){return`protocol-${this.type}`}dispose(){this._disposeMessageListener()}}("fs",(async e=>{if("isFile"===e.method)return this.options.fileResolver.isFile(e.params[0]);if("readFile"===e.method)return this.options.fileResolver.readFile(e.params[0]);throw new Error("Method not supported")}),this.iframeProtocol)),this.updateSandbox(this.sandboxSetup,!0))})),this.unsubscribeChannelListener=this.iframeProtocol.channelListen((e=>{switch(e.type){case"start":this.errors=[];break;case"status":this.status=e.status;break;case"action":"show-error"===e.action&&(this.errors=[...this.errors,(0,n.pp)(e)]);break;case"state":this.bundlerState=e.state}}))}setLocationURLIntoIFrame(){var e;const t=this.options.startRoute?new URL(this.options.startRoute,this.bundlerURL).toString():this.bundlerURL;null==(e=this.iframe.contentWindow)||e.location.replace(t),this.iframe.src=t}destroy(){this.unsubscribeChannelListener(),this.unsubscribeGlobalListener(),this.iframeProtocol.cleanup()}updateOptions(e){(0,o.J)(this.options,e)||(this.options=e,this.updateSandbox())}updateSandbox(e=this.sandboxSetup,t){var s,i,o,a;this.sandboxSetup={...this.sandboxSetup,...e};const d=this.getFiles(),l=Object.keys(d).reduce(((e,t)=>({...e,[t]:{code:d[t].code,path:t}})),{});let h=JSON.parse((0,n.F3)(this.sandboxSetup.dependencies,this.sandboxSetup.devDependencies,this.sandboxSetup.entry));try{h=JSON.parse(d["/package.json"].code)}catch(p){console.error((0,n.Tr)("could not parse package.json file: "+p.message))}const c=Object.keys(d).reduce(((e,t)=>({...e,[t]:{content:d[t].code,path:t}})),{});this.dispatch({type:"compile",codesandbox:!0,version:3,isInitializationCompile:t,modules:l,reactDevTools:this.options.reactDevTools,externalResources:this.options.externalResources||[],hasFileResolver:Boolean(this.options.fileResolver),disableDependencyPreprocessing:this.sandboxSetup.disableDependencyPreprocessing,template:this.sandboxSetup.template||r(h,c),showOpenInCodeSandbox:null==(s=this.options.showOpenInCodeSandbox)||s,showErrorScreen:null==(i=this.options.showErrorScreen)||i,showLoadingScreen:null==(o=this.options.showLoadingScreen)||o,skipEval:this.options.skipEval||!1,clearConsoleDisabled:!this.options.clearConsoleOnFirstCompile,logLevel:null!=(a=this.options.logLevel)?a:30,customNpmRegistries:this.options.customNpmRegistries})}dispatch(e){"refresh"===e.type&&this.setLocationURLIntoIFrame(),this.iframeProtocol.dispatch(e)}listen(e){return this.iframeProtocol.channelListen(e)}getCodeSandboxURL(){const e=this.getFiles(),t=Object.keys(e).reduce(((t,s)=>({...t,[s.replace("/","")]:{content:e[s].code,isBinary:!1}})),{});return fetch("https://codesandbox.io/api/v1/sandboxes/define?json=1",{method:"POST",body:JSON.stringify({files:t}),headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>e.json())).then((e=>({sandboxId:e.sandbox_id,editorUrl:`https://codesandbox.io/s/${e.sandbox_id}`,embedUrl:`https://codesandbox.io/embed/${e.sandbox_id}`})))}getFiles(){const{sandboxSetup:e}=this;return void 0===e.files["/package.json"]?(0,n.V0)(e.files,e.dependencies,e.devDependencies,e.entry):this.sandboxSetup.files}initializeElement(){this.iframe.style.border="0",this.iframe.style.width=this.options.width||"100%",this.iframe.style.height=this.options.height||"100%",this.iframe.style.overflow="hidden",(0,n.Wq)(this.element.parentNode,"The given iframe does not have a parent."),this.element.parentNode.replaceChild(this.iframe,this.element)}}}}]);